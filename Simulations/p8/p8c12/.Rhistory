#load("~/BalancedPed/Simulations/p3/p3c5/modelSmr.Rdata", envir = env_p3c5)
meanDiffLL_mtam_p3c5 <- env_p3c5$smr2$Minus2LogLikelihood - env_p3c5$smr1$Minus2LogLikelihood
PN <- ncol(env_p3c5[["smr1"]][["dataSummary"]][["fam1"]])*length(env_p3c5[["smr1"]][["dataSummary"]])
lamdaUnit_p3c5 <- meanDiffLL_mtam_p3c5/PN
SSize_p3c5 <- 1: 10000
LamdaVec_p3c5 <- lamdaUnit_p3c5*SSize_p3c5
powVec_p3c5 <- as.numeric(lapply(LamdaVec_p3c5,powerCal, df = 2))
df_p3c5 <- data.frame(Nped = SSize_p3c5,
power = powVec_p3c5,
Combination = rep("power1", 10000))
### create a new enviroment for one condition
env_p5c5 <- new.env()
load("~/R-Project/BalancedPed/Simulations/p5/p5c5/modelSmr.Rdata", envir = env_p5c5)
#load("~/BalancedPed/Simulations/p5/p5c5/modelSmr.Rdata", envir = env_p5c5)
meanDiffLL_mtam_p5c5 <- env_p5c5$smr2$Minus2LogLikelihood - env_p5c5$smr1$Minus2LogLikelihood
PN <- ncol(env_p5c5[["smr1"]][["dataSummary"]][["fam1"]])*length(env_p5c5[["smr1"]][["dataSummary"]])
lamdaUnit_p5c5 <- meanDiffLL_mtam_p5c5/PN
SSize_p5c5 <- 1: 10000
LamdaVec_p5c5 <- lamdaUnit_p5c5*SSize_p5c5
powVec_p5c5 <- as.numeric(lapply(LamdaVec_p5c5,powerCal, df = 2))
df_p5c5 <- data.frame(Nped = SSize_p5c5,
power = powVec_p5c5,
Combination = rep("power2", 10000))
### create a new enviroment for one condition
env_p8c5 <- new.env()
load("~/R-Project/BalancedPed/Simulations/p8/p8c5/modelSmr.Rdata", envir = env_p8c5)
#load("~/BalancedPed/Simulations/p8/p8c5/modelSmr.Rdata", envir = env_p8c5)
meanDiffLL_mtam_p8c5 <- env_p8c5$smr2$Minus2LogLikelihood - env_p8c5$smr1$Minus2LogLikelihood
PN <- ncol(env_p8c5[["smr1"]][["dataSummary"]][["fam1"]])*length(env_p8c5[["smr1"]][["dataSummary"]])
lamdaUnit_p8c5 <- meanDiffLL_mtam_p8c5/PN
SSize_p8c5 <- 1: 10000
LamdaVec_p8c5 <- lamdaUnit_p8c5*SSize_p8c5
powVec_p8c5 <- as.numeric(lapply(LamdaVec_p8c5,powerCal, df = 2))
df_p8c5 <- data.frame(Nped = SSize_p8c5,
power = powVec_p8c5,
Combination = rep("power3", 10000))
### create a new enviroment for one condition
env_p11c5 <- new.env()
load("~/R-Project/BalancedPed/Simulations/p11/p11c5/modelSmr.Rdata", envir = env_p11c5)
#load("~/BalancedPed/Simulations/p11/p11c5/modelSmr.Rdata", envir = env_p11c5)
meanDiffLL_mtam_p11c5 <- env_p11c5$smr2$Minus2LogLikelihood - env_p11c5$smr1$Minus2LogLikelihood
PN <- ncol(env_p11c5[["smr1"]][["dataSummary"]][["fam1"]])*length(env_p11c5[["smr1"]][["dataSummary"]])
lamdaUnit_p11c5 <- meanDiffLL_mtam_p11c5/PN
SSize_p11c5 <- 1: 10000
LamdaVec_p11c5 <- lamdaUnit_p11c5*SSize_p11c5
powVec_p11c5 <- as.numeric(lapply(LamdaVec_p11c5,powerCal, df = 2))
df_p11c5 <- data.frame(Nped = SSize_p11c5,
power = powVec_p11c5,
Combination = rep("power4", 10000))
### create a data frame for graphs
df_c5 <- rbind(df_p3c5,df_p5c5, df_p8c5, df_p11c5)
df_c5$Combination <- as.factor(df_c5$Combination)
g1 <-ggplot(data = df_c5)+ geom_line(mapping = aes(x = Nped, y = power, color= Combination), size = 1.5) +
scale_color_manual(values=my_palette[1:4],
name="Pedigree Structures",
breaks=c("power1", "power2", "power3", "power4"),
labels=c("k = 4, s = 4, m = 56",
"k = 3, s = 5, m = 61",
"k = 3, s = 8, m = 509",
"k = 6, s = 6, m = 2388")
)+
theme(panel.background = element_rect(fill = "transparent"),
panel.grid = element_line(color = "transparent"),
axis.line = element_line(size = 1, colour = "black"),
#axis.line.y = element_blank(),
axis.text = element_text( color = "black"),
#axis.text.y = element_blank(),
#axis.ticks.y = element_blank(),
text=element_text( family="Calibri",  size = 12),
legend.spacing = unit(-17,'pt'),
legend.margin = margin(t=0,b=0,unit='pt'),
legend.background = element_rect(),
legend.position=c(.8,.2))+
xlab("N of Individuals")+
scale_y_continuous(n.breaks = 6)+
ylab("Power (mt\u00B2+j\u00B2)")+
geom_hline(yintercept = .8, linetype = 5, size = .8, color = "grey")
# +
# annotate(geom = "text",x = 0.62, y =.92, label = "a\u00B2 = .6", family="Calibri", color = "gray40",size = 3)+
# annotate(geom = "text",x = 0.73, y =.6, label = "a\u00B2 = .4", family="Calibri", color = "gray40",size = 3)+
# annotate(geom = "text",x = 0.9, y =.6, label = "a\u00B2 = .2", family="Calibri", color = "gray40",size = 3)+
# annotate(geom = "text",x = 0.9, y =.6, label = "a\u00B2 = .4, d\u00B2 = .1", family="Calibri", color = "gray40",size = 3)
g1
ggsave( "~/R-Project/BalancedPed/Graphs/graph_c5p35811.png",g1, width = 6, height = 4.5,  type = "cairo-png", dpi = 900)
rm(list = ls())
library(ggplot2)
powerCal <- function(lamda,df){
1- pchisq(qchisq(1-.05, df), df, lamda)
}
my_palette <- c( "#E41A1C", "#332288", "#E69F00", "#117A65", "#DDCC77", "#377EB8",  "#4DAF4A",  "#56B4E9", "#A6CE39", "#A9A9A9","#88CCEE", "#CC6677",  "#AA4499",   "#999933", "#882255", "#984EA3")
### create a new enviroment for one condition
env_p3c5 <- new.env()
load("~/R-Project/BalancedPed/Simulations/p3/p3c5/modelSmr.Rdata", envir = env_p3c5)
#load("~/BalancedPed/Simulations/p3/p3c5/modelSmr.Rdata", envir = env_p3c5)
meanDiffLL_mtam_p3c5 <- env_p3c5$smr2$Minus2LogLikelihood - env_p3c5$smr1$Minus2LogLikelihood
PN <- ncol(env_p3c5[["smr1"]][["dataSummary"]][["fam1"]])*length(env_p3c5[["smr1"]][["dataSummary"]])
lamdaUnit_p3c5 <- meanDiffLL_mtam_p3c5/PN
SSize_p3c5 <- 1: 10000
LamdaVec_p3c5 <- lamdaUnit_p3c5*SSize_p3c5
powVec_p3c5 <- as.numeric(lapply(LamdaVec_p3c5,powerCal, df = 2))
df_p3c5 <- data.frame(Nped = SSize_p3c5,
power = powVec_p3c5,
Combination = rep("power1", 10000))
### create a new enviroment for one condition
env_p5c5 <- new.env()
load("~/R-Project/BalancedPed/Simulations/p5/p5c5/modelSmr.Rdata", envir = env_p5c5)
#load("~/BalancedPed/Simulations/p5/p5c5/modelSmr.Rdata", envir = env_p5c5)
meanDiffLL_mtam_p5c5 <- env_p5c5$smr2$Minus2LogLikelihood - env_p5c5$smr1$Minus2LogLikelihood
PN <- ncol(env_p5c5[["smr1"]][["dataSummary"]][["fam1"]])*length(env_p5c5[["smr1"]][["dataSummary"]])
lamdaUnit_p5c5 <- meanDiffLL_mtam_p5c5/PN
SSize_p5c5 <- 1: 10000
LamdaVec_p5c5 <- lamdaUnit_p5c5*SSize_p5c5
powVec_p5c5 <- as.numeric(lapply(LamdaVec_p5c5,powerCal, df = 2))
df_p5c5 <- data.frame(Nped = SSize_p5c5,
power = powVec_p5c5,
Combination = rep("power2", 10000))
### create a new enviroment for one condition
env_p8c5 <- new.env()
load("~/R-Project/BalancedPed/Simulations/p8/p8c5/modelSmr.Rdata", envir = env_p8c5)
#load("~/BalancedPed/Simulations/p8/p8c5/modelSmr.Rdata", envir = env_p8c5)
meanDiffLL_mtam_p8c5 <- env_p8c5$smr2$Minus2LogLikelihood - env_p8c5$smr1$Minus2LogLikelihood
PN <- ncol(env_p8c5[["smr1"]][["dataSummary"]][["fam1"]])*length(env_p8c5[["smr1"]][["dataSummary"]])
lamdaUnit_p8c5 <- meanDiffLL_mtam_p8c5/PN
SSize_p8c5 <- 1: 10000
LamdaVec_p8c5 <- lamdaUnit_p8c5*SSize_p8c5
powVec_p8c5 <- as.numeric(lapply(LamdaVec_p8c5,powerCal, df = 2))
df_p8c5 <- data.frame(Nped = SSize_p8c5,
power = powVec_p8c5,
Combination = rep("power3", 10000))
### create a new enviroment for one condition
env_p11c5 <- new.env()
load("~/R-Project/BalancedPed/Simulations/p11/p11c5/modelSmr.Rdata", envir = env_p11c5)
#load("~/BalancedPed/Simulations/p11/p11c5/modelSmr.Rdata", envir = env_p11c5)
meanDiffLL_mtam_p11c5 <- env_p11c5$smr2$Minus2LogLikelihood - env_p11c5$smr1$Minus2LogLikelihood
PN <- ncol(env_p11c5[["smr1"]][["dataSummary"]][["fam1"]])*length(env_p11c5[["smr1"]][["dataSummary"]])
lamdaUnit_p11c5 <- meanDiffLL_mtam_p11c5/PN
SSize_p11c5 <- 1: 10000
LamdaVec_p11c5 <- lamdaUnit_p11c5*SSize_p11c5
powVec_p11c5 <- as.numeric(lapply(LamdaVec_p11c5,powerCal, df = 2))
df_p11c5 <- data.frame(Nped = SSize_p11c5,
power = powVec_p11c5,
Combination = rep("power4", 10000))
### create a data frame for graphs
df_c5 <- rbind(df_p3c5,df_p5c5, df_p8c5, df_p11c5)
df_c5$Combination <- as.factor(df_c5$Combination)
g1 <-ggplot(data = df_c5)+ geom_line(mapping = aes(x = Nped, y = power, color= Combination), size = 1.5) +
scale_color_manual(values=my_palette[1:4],
name="Pedigree Structures",
breaks=c("power1", "power2", "power3", "power4"),
labels=c("k = 4, s = 4, m = 56",
"k = 3, s = 5, m = 61",
"k = 3, s = 8, m = 509",
"k = 6, s = 6, m = 2388")
)+
theme(panel.background = element_rect(fill = "transparent"),
panel.grid = element_line(color = "transparent"),
axis.line = element_line(size = 1, colour = "black"),
#axis.line.y = element_blank(),
axis.text = element_text( color = "black"),
#axis.text.y = element_blank(),
#axis.ticks.y = element_blank(),
text=element_text( family="Calibri",  size = 12),
legend.spacing = unit(-17,'pt'),
legend.margin = margin(t=0,b=0,unit='pt'),
legend.background = element_rect(),
legend.position=c(.8,.2))+
xlab("N of Individuals")+
scale_y_continuous(n.breaks = 6)+
ylab("Power (mt\u00B2+j\u00B2)")+
geom_hline(yintercept = .8, linetype = 5, size = .8, color = "grey")
# +
# annotate(geom = "text",x = 0.62, y =.92, label = "a\u00B2 = .6", family="Calibri", color = "gray40",size = 3)+
# annotate(geom = "text",x = 0.73, y =.6, label = "a\u00B2 = .4", family="Calibri", color = "gray40",size = 3)+
# annotate(geom = "text",x = 0.9, y =.6, label = "a\u00B2 = .2", family="Calibri", color = "gray40",size = 3)+
# annotate(geom = "text",x = 0.9, y =.6, label = "a\u00B2 = .4, d\u00B2 = .1", family="Calibri", color = "gray40",size = 3)
g1
ggsave( "~/R-Project/BalancedPed/Graphs/graph_c5p35811.png",g1, width = 6, height = 4.5,  type = "cairo-png", dpi = 900)
rm(list = ls())
### a script to calculate the number of individuals for a power of .8 in all conditions.
vec_p <- paste("p", 1:11, sep = "")
vec_c <- paste("c", 1:11, sep = "")
df_results <- matrix(nrow = 11, ncol = 11)
colnames(df_results) <- vec_p
rownames(df_results) <- vec_c
View(df_results)
lunit <- .0000001
ssize <- 1:100000
l_vec <- lunit*ssize
powerCal <- function(lamda,df){
1- pchisq(qchisq(1-.05, df), df, lamda)
}
powVec <- as.numeric(lapply(l_vec,powerCal, df = 2))
which(powVec==.80)
which(round(powVec)==.80)
which.min(abs(powVec-.80))
lunit <- .00001
ssize <- 1:1000000
l_vec <- lunit*ssize
powerCal <- function(lamda,df){
1- pchisq(qchisq(1-.05, df), df, lamda)
}
powVec <- as.numeric(lapply(l_vec,powerCal, df = 2))
which.min(abs(powVec-.80))
tgt_lunit <- which.min(abs(powVec-.80))*lunit
### a script to calculate the number of individuals for a power of .8 in all conditions.
vec_p <- paste("p", 1:11, sep = "")
vec_c <- paste("c", 1:11, sep = "")
df_results <- matrix(nrow = 11, ncol = 11)
colnames(df_results) <- vec_p
rownames(df_results) <- vec_c
lunit <- .00001
ssize <- 1:1000000
l_vec <- lunit*ssize
powerCal <- function(lamda,df){
1- pchisq(qchisq(1-.05, df), df, lamda)
}
powVec <- as.numeric(lapply(l_vec,powerCal, df = 2))
tgt_lunit <- which.min(abs(powVec-.80))*lunit
for (p in 1: 11){
for (c in 1: 11){
dir <- paste0("~/R-Project/BalancedPed/Simulations/p",p,"/p",p, "c",c)
if (dir.exists(dir)){
#cat("starttime:", as.character(Sys.time()))
cat("running", dir)
setwd(dir)
load("modelSmr.Rdata")
meanDiffLL_mtam <- smr2$Minus2LogLikelihood - smr1$Minus2LogLikelihood
PN <- ncol(smr1[["dataSummary"]][["fam1"]])*length(smr1[["dataSummary"]])
lamdaUnit <- meanDiffLL_mtam/PN
df_results[c,p] <- round(tgt_lunit/lamdaUnit)
#cat("finished at" , as.character(Sys.time()))
}else{
next
}
}
}
### a script to calculate the number of individuals for a power of .8 in all conditions.
vec_p <- paste("p", 1:11, sep = "")
vec_c <- paste("c", 1:11, sep = "")
df_results <- matrix(nrow = 11, ncol = 11)
colnames(df_results) <- vec_p
rownames(df_results) <- vec_c
lunit <- .00001
ssize <- 1:1000000
l_vec <- lunit*ssize
powerCal <- function(lamda,df){
1- pchisq(qchisq(1-.05, df), df, lamda)
}
powVec <- as.numeric(lapply(l_vec,powerCal, df = 2))
tgt_lunit <- which.min(abs(powVec-.80))*lunit
for (p in 1: 11){
for (c in 1: 11){
dir <- paste0("~/R-Project/BalancedPed/Simulations/p",p,"/p",p, "c",c)
if (dir.exists(dir)){
#cat("starttime:", as.character(Sys.time()))
cat("\n","running", dir)
setwd(dir)
load("modelSmr.Rdata")
meanDiffLL_mtam <- smr2$Minus2LogLikelihood - smr1$Minus2LogLikelihood
PN <- ncol(smr1[["dataSummary"]][["fam1"]])*length(smr1[["dataSummary"]])
lamdaUnit <- meanDiffLL_mtam/PN
df_results[c,p] <- round(tgt_lunit/lamdaUnit)
#cat("finished at" , as.character(Sys.time()))
}else{
next
}
}
}
write.table(df_results, "~/R-Project/BalancedPed/Graphs/PowerTable.csv", quote = FALSE, sep = ",")
###code to run first trial of simulation
#source("~/R-Project/BalancedPed/evenInsert.R")
#source("~/R-Project/BalancedPed/famSizeCal.R")
#source("~/R-Project/BalancedPed/SimPed.R")
source("~/R-Project/BalancedPed/HelperFunctions.R")
setwd("~/R-Project/BalancedPed/Simulations/p8/p8c12")
library(OpenMx)
load("~/R-Project/BalancedPed/FixedPed.RData")
sampleFam <- ped8
Addmat <- as.matrix(ped2add(sampleFam, verbose = TRUE))
Nucmat <- ped2cn(sampleFam)
Extmat <- ped2ce(sampleFam)
Mtdmat <- ped2mt_v3(sampleFam)
Envmat <- diag(1,nrow = nrow(Addmat))
dimnames(Envmat) <- dimnames(Addmat)
Amimat <- Addmat*Mtdmat
Dmgmat <- Addmat*Addmat
# Trial-Combination 11
ad2 <- c( .6, .6, .6, .4, .4, .4, .2, .2, .2, .4, .4, .4)
dd2 <- c( .0, .0, .0, .0, .0, .0, .0, .0, .0, .0, .1, .0)
cn2 <- c( .1, .1, .1, .1, .1, .1, .1, .1, .1, .2, .1, .1)
ce2 <- c( .1, .1, .1, .1, .1, .1, .1, .1, .1, .1, .1, .1)
mt2 <- c( .1,.05,.01, .1,.05,.01, .1,.05,.01,.05,.05, .1)
am2 <- c(.05,.05,.05,.05,.05,.05,.05,.05,.05,.05,.05, .1)
ee2 <- c(.05, .1,.19,.25,.30,.39,.45,.50,.59, .2, .2, .2)
## generate data
library(mvtnorm)
comb <- 12
sumCov <- ad2[comb]*Addmat + dd2[comb]*Addmat*Addmat + cn2[comb]*Nucmat + ce2[comb]*Extmat + mt2[comb]*Mtdmat + am2[comb]*Addmat*Mtdmat + ee2[comb]*Envmat
set.seed(14271)
numfam <- round(10000/nrow(Addmat))
dat <- rmvnorm(numfam, sigma = sumCov)
#setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# fit ML model
totalVar <- 1
totalMea <- 0
ObjectsKeep <- as.character(ls())
## the full model
Model1 <- mxModel(
"ModelOne",
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = ad2[comb]*totalVar, labels = "vad", name = "Vad", lbound = 1e-10),
#      mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = dd2[comb]*totalVar, labels = "vdd", name = "Vdd", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = cn2[comb]*totalVar, labels = "vcn", name = "Vcn", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = ce2[comb]*totalVar, labels = "vce", name = "Vce", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = mt2[comb]*totalVar, labels = "vmt", name = "Vmt", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = am2[comb]*totalVar, labels = "vam", name = "Vam", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = ee2[comb]*totalVar, labels = "ver", name = "Ver", lbound = 1e-10)
)
ll <- list()
for (i in 1:numfam){
ll[[i]] <- dat[i,]
}
modList <- list()
modNames <- paste0("fam", 1:numfam)
for(afam in 1:numfam){
ytemp <- paste('S', rownames (Addmat))
fsize <- nrow(Addmat)
modList[[afam]] <- mxModel(name=modNames[afam],
mxMatrix("Iden", nrow=fsize, ncol=fsize, name="I"),
mxMatrix("Unit", nrow=fsize, ncol=fsize, name='U'),
mxMatrix("Symm", nrow=fsize, ncol=fsize, values=Addmat, name="A"),
##                                 mxMatrix("Symm", nrow=fsize, ncol=fsize, values=Dmgmat, name="D"),
mxMatrix("Symm", nrow=fsize, ncol=fsize, values=Nucmat, name="Cn"),
mxMatrix("Symm", nrow=fsize, ncol=fsize, values=Extmat, name="Ce"),
mxMatrix("Symm", nrow=fsize, ncol=fsize, values=Amimat, name="Am"),
mxMatrix("Symm", nrow=fsize, ncol=fsize, values=Mtdmat, name="Mt"),
mxData(observed = matrix(ll[[afam]], nrow=1, dimnames=list(NULL, ytemp)), type="raw", sort=FALSE),
mxMatrix('Full', nrow=1, ncol=fsize, name='M', free=TRUE, labels='meanLI',
dimnames=list(NULL, ytemp)),
mxAlgebra ((A %x% ModelOne.Vad)
##                                            + (D %x% ModelOne.Vdd)
+ (Cn %x% ModelOne.Vcn)
+ (U %x% ModelOne.Vce)
+ (Mt %x% ModelOne.Vmt)
+ (Am %x% ModelOne.Vam)
+ (I %x% ModelOne.Ver),
name="V", dimnames=list(ytemp, ytemp)),
mxExpectationNormal(covariance='V', means='M'),
mxFitFunctionML()
)
}
container <- mxModel('Model2', Model1, modList, mxFitFunctionMultigroup(modNames))
container <- mxOption(container, 'Checkpoint Units', 'minutes')
container <- mxOption(container, 'Checkpoint Count', 1)
containerRun <- mxRun(container, intervals=FALSE, checkpoint=TRUE)
smr1 <- summary(containerRun)
save.image(file = "model1.RData")
rm(list = setdiff(ls(), c(ObjectsKeep, "ObjectsKeep", "smr1")))
##### Model excluding mt and am
Model4 <- mxModel(
"ModelThree",
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = ad2[comb]*totalVar, labels = "vad", name = "Vad", lbound = 1e-10),
#      mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = dd2[comb]*totalVar, labels = "vdd", name = "Vdd", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = cn2[comb]*totalVar, labels = "vcn", name = "Vcn", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = ce2[comb]*totalVar, labels = "vce", name = "Vce", lbound = 1e-10),
#mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = mt2[comb]*totalVar, labels = "vmt", name = "Vmt", lbound = 1e-10),
#mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = am2[comb]*totalVar, labels = "vam", name = "Vam", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = ee2[comb]*totalVar, labels = "ver", name = "Ver", lbound = 1e-10)
)
ll2 <- list()
for (i in 1:numfam){
ll2[[i]] <- dat[i,]
}
modList2 <- list()
modNames2 <- paste0("fam", 1:numfam)
for(afam2 in 1:numfam){
ytemp2 <- paste('S', rownames (Addmat))
fsize2 <- nrow(Addmat)
modList2[[afam2]] <- mxModel(name=modNames2[afam2],
mxMatrix("Iden", nrow=fsize2, ncol=fsize2, name="I"),
mxMatrix("Unit", nrow=fsize2, ncol=fsize2, name='U'),
mxMatrix("Symm", nrow=fsize2, ncol=fsize2, values=Addmat, name="A"),
#                                   mxMatrix("Symm", nrow=fsize2, ncol=fsize2, values=Dmgmat, name="D"),
mxMatrix("Symm", nrow=fsize2, ncol=fsize2, values=Nucmat, name="Cn"),
mxMatrix("Symm", nrow=fsize2, ncol=fsize2, values=Extmat, name="Ce"),
#mxMatrix("Symm", nrow=fsize2, ncol=fsize2, values=Amimat, name="Am"),
#mxMatrix("Symm", nrow=fsize2, ncol=fsize2, values=Mtdmat, name="Mt"),
mxData(observed = matrix(ll2[[afam2]], nrow=1, dimnames=list(NULL, ytemp2)), type="raw", sort=FALSE),
mxMatrix('Full', nrow=1, ncol=fsize2, name='M', free=TRUE, labels='meanLI',
dimnames=list(NULL, ytemp2)),
mxAlgebra ((A %x% ModelThree.Vad)
#                                              + (D %x% ModelThree.Vdd)
+ (Cn %x% ModelThree.Vcn)
+ (U %x% ModelThree.Vce)
#+ (Mt %x% ModelThree.Vmt)
#+ (Am %x% ModelThree.Vam)
+ (I %x% ModelThree.Ver),
name="V", dimnames=list(ytemp2, ytemp2)),
mxExpectationNormal(covariance='V', means='M'),
mxFitFunctionML()
)
}
container2 <- mxModel('Model4', Model4, modList2, mxFitFunctionMultigroup(modNames2))
container2 <- mxOption(container2, 'Checkpoint Units', 'minutes')
container2 <- mxOption(container2, 'Checkpoint Count', 1)
containerRun2 <- mxRun(container2, intervals=FALSE, checkpoint=TRUE)
smr2 <- summary(containerRun2)
save.image(file = "model2.RData")
rm(list = setdiff(ls(), c(ObjectsKeep,"ObjectsKeep", "smr1", "smr2")))
##### Model excluding mt
Model5 <- mxModel(
"ModelFive",
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = ad2[comb]*totalVar, labels = "vad", name = "Vad", lbound = 1e-10),
#      mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = dd2[comb]*totalVar, labels = "vdd", name = "Vdd", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = cn2[comb]*totalVar, labels = "vcn", name = "Vcn", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = ce2[comb]*totalVar, labels = "vce", name = "Vce", lbound = 1e-10),
#mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = mt2[comb]*totalVar, labels = "vmt", name = "Vmt", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = am2[comb]*totalVar, labels = "vam", name = "Vam", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = ee2[comb]*totalVar, labels = "ver", name = "Ver", lbound = 1e-10)
)
ll3 <- list()
for (i in 1:numfam){
ll3[[i]] <- dat[i,]
}
modList3 <- list()
modNames3 <- paste0("fam", 1:numfam)
for(afam3 in 1:numfam){
ytemp3 <- paste('S', rownames (Addmat))
fsize3 <- nrow(Addmat)
modList3[[afam3]] <- mxModel(name=modNames3[afam3],
mxMatrix("Iden", nrow=fsize3, ncol=fsize3, name="I"),
mxMatrix("Unit", nrow=fsize3, ncol=fsize3, name='U'),
mxMatrix("Symm", nrow=fsize3, ncol=fsize3, values=Addmat, name="A"),
#                                   mxMatrix("Symm", nrow=fsize3, ncol=fsize3, values=Dmgmat, name="D"),
mxMatrix("Symm", nrow=fsize3, ncol=fsize3, values=Nucmat, name="Cn"),
mxMatrix("Symm", nrow=fsize3, ncol=fsize3, values=Extmat, name="Ce"),
mxMatrix("Symm", nrow=fsize3, ncol=fsize3, values=Amimat, name="Am"),
#mxMatrix("Symm", nrow=fsize3, ncol=fsize3, values=Mtdmat, name="Mt"),
mxData(observed = matrix(ll3[[afam3]], nrow=1, dimnames=list(NULL, ytemp3)), type="raw", sort=FALSE),
mxMatrix('Full', nrow=1, ncol=fsize3, name='M', free=TRUE, labels='meanLI',
dimnames=list(NULL, ytemp3)),
mxAlgebra ((A %x% ModelFive.Vad)
#                                              + (D %x% ModelFive.Vdd)
+ (Cn %x% ModelFive.Vcn)
+ (U %x% ModelFive.Vce)
#+ (Mt %x% ModelFive.Vmt)
+ (Am %x% ModelFive.Vam)
+ (I %x% ModelFive.Ver),
name="V", dimnames=list(ytemp3, ytemp3)),
mxExpectationNormal(covariance='V', means='M'),
mxFitFunctionML()
)
}
container3 <- mxModel('Model6', Model5, modList3, mxFitFunctionMultigroup(modNames3))
container3 <- mxOption(container3, 'Checkpoint Units', 'minutes')
container3 <- mxOption(container3, 'Checkpoint Count', 1)
containerRun3 <- mxRun(container3, intervals=FALSE, checkpoint=TRUE)
smr3 <- summary(containerRun3)
save.image(file = "model3.RData")
rm(list = setdiff(ls(), c(ObjectsKeep,"ObjectsKeep", "smr1", "smr2", "smr3")))
##### Model excluding am
Model7 <- mxModel(
"ModelSeven",
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = ad2[comb]*totalVar, labels = "vad", name = "Vad", lbound = 1e-10),
#      mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = dd2[comb]*totalVar, labels = "vdd", name = "Vdd", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = cn2[comb]*totalVar, labels = "vcn", name = "Vcn", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = ce2[comb]*totalVar, labels = "vce", name = "Vce", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = mt2[comb]*totalVar, labels = "vmt", name = "Vmt", lbound = 1e-10),
#mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = am2[comb]*totalVar, labels = "vam", name = "Vam", lbound = 1e-10),
mxMatrix(type = "Full", nrow = 1, ncol = 1, free = TRUE, values = ee2[comb]*totalVar, labels = "ver", name = "Ver", lbound = 1e-10)
)
ll4 <- list()
for (i in 1:numfam){
ll4[[i]] <- dat[i,]
}
modList4 <- list()
modNames4 <- paste0("fam", 1:numfam)
for(afam4 in 1:numfam){
ytemp4 <- paste('S', rownames (Addmat))
fsize4 <- nrow(Addmat)
modList4[[afam4]] <- mxModel(name=modNames4[afam4],
mxMatrix("Iden", nrow=fsize4, ncol=fsize4, name="I"),
mxMatrix("Unit", nrow=fsize4, ncol=fsize4, name='U'),
mxMatrix("Symm", nrow=fsize4, ncol=fsize4, values=Addmat, name="A"),
#                                   mxMatrix("Symm", nrow=fsize4, ncol=fsize4, values=Dmgmat, name="D"),
mxMatrix("Symm", nrow=fsize4, ncol=fsize4, values=Nucmat, name="Cn"),
mxMatrix("Symm", nrow=fsize4, ncol=fsize4, values=Extmat, name="Ce"),
#mxMatrix("Symm", nrow=fsize4, ncol=fsize4, values=Amimat, name="Am"),
mxMatrix("Symm", nrow=fsize4, ncol=fsize4, values=Mtdmat, name="Mt"),
mxData(observed = matrix(ll4[[afam4]], nrow=1, dimnames=list(NULL, ytemp4)), type="raw", sort=FALSE),
mxMatrix('Full', nrow=1, ncol=fsize4, name='M', free=TRUE, labels='meanLI',
dimnames=list(NULL, ytemp4)),
mxAlgebra ((A %x% ModelSeven.Vad)
#                                              + (D %x% ModelSeven.Vdd)
+ (Cn %x% ModelSeven.Vcn)
+ (U %x% ModelSeven.Vce)
+ (Mt %x% ModelSeven.Vmt)
#+ (Am %x% ModelSeven.Vam)
+ (I %x% ModelSeven.Ver),
name="V", dimnames=list(ytemp4, ytemp4)),
mxExpectationNormal(covariance='V', means='M'),
mxFitFunctionML()
)
}
container4 <- mxModel('Model8', Model7, modList4, mxFitFunctionMultigroup(modNames4))
container4 <- mxOption(container4, 'Checkpoint Units', 'minutes')
container4 <- mxOption(container4, 'Checkpoint Count', 1)
containerRun4 <- mxRun(container4, intervals=FALSE, checkpoint=TRUE)
smr4 <- summary(containerRun4)
save.image(file = "model4.RData")
rm(list = setdiff(ls(), c("smr1", "smr2", "smr3", "smr4")))
save.image(file = "modelSmr.RData")
rm(list = ls())
